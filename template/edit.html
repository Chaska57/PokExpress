<!DOCTYPE html>
<html lang="en">
    {% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link  href="https://unpkg.com/cropperjs/dist/cropper.min.css" rel="stylesheet"/>
    <script src="https://unpkg.com/cropperjs/dist/cropper.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/base.css' %}">

</head>
<body class="bg-neutral-500">


    <form method="POST" action="/edit/{{ user.id }}/" enctype="multipart/form-data">
        {% csrf_token %}
        <section class="relative pt-40 pb-2">
            <img id="bannerPreview" src="{{ user.banner.url }}" alt="cover-image" class="w-full absolute top-0 left-0 z-0 h-60 object-cover">
            <input id="bannerUpload" type="file" name="banner" class="hidden" onchange="previewBanner(event)">
            <!-- Botón que dispara el input -->
            <label for="bannerUpload" class="absolute top-4 right-4 bg-orange-300 hover:bg-orange-600 text-white px-4 py-2 rounded cursor-pointer">
                Cambiar Banner
            </label>
            <a href="/user/{{ user.id }}/" class="absolute top-4 left-4 bg-orange-300 hover:bg-orange-600 text-white px-4 py-2 rounded cursor-pointer"> Regresar</a>
            <div class="w-full max-w-7xl mx-auto px-6 md:px-8">

                <div class="flex items-center justify-center sm:justify-start relative z-10 mb-5">  
                    <img id="profilePreview" src="{{ user.photo.url }}" alt="user-avatar-image" class="h-50 w-50 border-4 border-solid border-neutral-500 rounded-full object-cover">
                    <input id="profileUpload" type="file" name="photo" class="hidden"  onchange="previewProfile(event)">
                    <label for="profileUpload" class="ml-4 mt-6 bg-orange-300 hover:bg-orange-600 text-white px-4 py-2 rounded cursor-pointer">
                        Cambiar Avatar
                    </label>
                </div>

                <div class="flex flex-col sm:flex-row max-sm:gap-5 items-center justify-between mb-5">
                    <div class="block">
                        <label class="titulo-pokedex">
                            <h3 class="font-manrope font-bold text-4xl text-gray-900 mb-1">
                            <input type="text" name="name" value="{{ user.name }}"></h3>
                        </label>
                    </div>
                </div>

                <div class="flex flex-col lg:flex-row max-lg:gap-5 items-center justify-between py-0.5">
                    <div class="flex items-center gap-4">
                        
                        <button type="submit"
                            class="py-3.5 px-5 rounded-full bg-indigo-50  font-semibold text-base leading-7 shadow-sm shadow-transparent transition-all duration-500 bg-orange-300 hover:bg-orange-600">Guardar cambios</button>
                    </div>

                </div>
            </div>
        </section>
    </form>  

    <div class="mt-0 mx-auto max-w-2xl px-4 py-16 sm:px-6 sm:py-24 lg:max-w-7xl lg:px-8">
        <div class="grid grid-cols-1 gap-x-6 gap-y-10 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 xl:gap-x-8">
       {% for registro in user_fishes %}
            <div href="#" class="group carta">
                {% if registro.captured and registro.captured.captured %}
                    {% if registro.captured.photo %}
                        <!-- Capturado y con foto del usuario -->
                        <img src="{{ registro.captured.photo.url }}" alt="Foto del usuario"
                            class="aspect-square w-full rounded-lg bg-gray-200 object-cover group-hover:opacity-75 xl:aspect-7/8">
                    {% elif registro.fish.photo %}
                        <!-- Capturado pero sin foto del usuario -->
                        <img src="{{ registro.fish.photo.url }}" alt="Foto del pez por defecto"
                            class="aspect-square w-full rounded-lg bg-gray-200 object-cover group-hover:opacity-75 xl:aspect-7/8">
                    {% endif %}
                {% elif registro.fish.photo %}
                    <!-- No capturado: siempre mostrar la foto por defecto -->
                    <img src="{{ registro.fish.photo.url }}" alt="Foto del pez por defecto"
                        class="aspect-square w-full rounded-lg bg-gray-200 object-cover group-hover:opacity-75 xl:aspect-7/8">
                {% endif %}

                <h3 class="mt-4 text-sm">{{ registro.fish.scientific_name }}</h3>
                <p class="mt-1 text-lg font-medium">{{ registro.fish.name }}</p>

                {% if registro.captured and registro.captured.captured %}
                    <p>Capturado: ✔️</p>
                {% else %}
                    <p>No capturado ❌</p>
                {% endif %}
            </div>
        {% endfor %}   
        </div>
    </div>

</body>



<script>
 function previewProfile(event) {
    const input = event.target;
    const preview = document.getElementById("profilePreview");
    const placeholder = document.getElementById("profilePlaceholder");

    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.classList.remove("hidden");
        placeholder.classList.add("hidden");
      };
      reader.readAsDataURL(input.files[0]);
    }
  }



  function previewBanner(event) {
    const input = event.target;
    const preview = document.getElementById("bannerPreview");
    const placeholder = document.getElementById("bannerPlaceholder");

    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.classList.remove("hidden");
        placeholder.classList.add("hidden");
      };
      reader.readAsDataURL(input.files[0]);
    }
  }

  function handleFormSubmit(event) {
    // Solo evita comportamiento no deseado si es necesario.
    // Por ejemplo, puedes hacer validaciones aquí antes de enviar.
    // event.preventDefault(); // Descomenta para evitar el envío real
    // alert('Formulario enviado'); // Para probar
  }
</script>

</html>